<div class="b-class-block class" sticky use-placeholder>
    <div class="container cf">
        <div class="w-left">
            <h2><a ui-sref="admin.classes">Classes</a> / {{class.title || 'New Class'}}</h2>
            <div class="info" ng-if="$stateParams.classId">
                <p>{{occurrences.length}} Classes scheduled</p>
                <p>{{class.location}}</p>
                <p class="status" ng-class="{'green': class.status === 'LIVE'}">{{class.status}}</p>
            </div>
        </div>
        <div class="w-right">
            <button type="button" ng-click="saveDraft()"><i class="fa fa-save"></i>Save as draft</button>
            <button ng-if="$stateParams.classId" class="green" type="button" ng-click="savePublic()"><i class="fa fa-save"></i>Save & go live</button>
            <button ng-if="$stateParams.classId" type="button" class="red" ng-confirm-click="remove()"><i class="fa fa-trash"></i>Delete</button>
        </div>
    </div>
</div>
<div class="container">
    <div class="b-class-edit">
        <h3>Main info</h3>
        <div class="form-rel">
            <label class="form-label" for="title">Name der Stunde</label>
            <input class="form-input" type="text" ng-model="class.title" id="title"/>
        </div>
        <div class="form-rel">
            <label class="form-label" for="location">Standort</label>
            <select chosen
                    id="location"
                    ng-model="class.locationId"
                    data-placeholder="Select Location"
                    disable-search="false"
                    ng-options="item.id as item.name for item in locations">
                <option value=""></option>
            </select>
        </div>
        <div class="form-rel auto" ng-if="$stateParams.classId" id="datesSchedule" disable-animate>
            <label class="form-label">Event dates</label>
            <table class="b-date-group" ng-if="!showSchedule" ng-repeat="(key, value) in groupByAll">
                <thead>
                    <tr>
                        <th><p>{{value.length}}</p><p>Date{{value.length > 1 ? 's' : ''}}</p></th>
                        <th><p>{{value.repeat}} {{value.day}} {{value.startTime}} - {{value.endTime}}</p><p><span>{{value.frame}}</span></p></th>
                        <th>
                            <div class="controls">
                                <a href="" ng-click="toggleGroup(value)"><i class="fa fa-list"></i></a>
                                <a href="" ng-click="editGroup(value)"><i class="fa fa-pencil"></i></a>
                                <a href="" ng-click="deleteGroup(value)"><i class="fa fa-trash"></i></a>
                            </div>
                        </th>
                    </tr>
                </thead>
                <tbody ng-if="!value.hide">
                    <tr ng-repeat="c in value">
                        <td></td>
                        <td>{{c.start_date | amDateFormat: 'dddd, D MMMM YYYY'}} ({{c.startTime}} to {{c.endTime}})</td>
                        <td>
                            <div class="controls">
                                <a href="" ng-click="editSingle(c)"><i class="fa fa-pencil"></i></a>
                                <a href="" ng-click="deleteSingle(c)"><i class="fa fa-trash"></i></a>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="form-rel" ng-if="!showSchedule">
                <button class="green" ng-click="addDates()" type="button">Add Dates</button>
            </div>
            <span class="spinner" ng-show="showSpinner" us-spinner="{lines: 11, radius:10, width:5, length: 7, color: '#ff695c', left: 0, top: 20}"></span>
            <form name="formSchedule" class="b-date-schedule" ng-class="{'disabled': showSpinner}" ng-show="showSchedule" ng-submit="saveSchedule()">
                <h3 ng-if="newEvent">Schedule dates</h3>
                <h3 ng-if="schedule.repeat === 'Single' && !newEvent">Edit a single date</h3>
                <h3 ng-if="schedule.repeat !== 'Single' && !newEvent">Edit {{schedule.repeat | lowercase}} repeating dates</h3>
                <div class="form-rel" ng-if="newEvent">
                    <label class="form-label" for="repeat">Event repeats</label>
                    <select chosen
                            id="repeat"
                            ng-model="schedule.repeat"
                            ng-change="updateSchedule()"
                            data-placeholder="Select repeats"
                            disable-search="true" required
                            ng-options="item for item in repeatList">
                        <option value=""></option>
                    </select>
                </div>
                <div class="form-rel" ng-if="schedule.repeat === 'Weekly'">
                    <label class="form-label" for="weekday">Repeating every</label>
                    <select chosen
                            id="weekday"
                            ng-model="schedule.weekday"
                            ng-change="updateSchedule()"
                            data-placeholder="Select repeats"
                            disable-search="true" required
                            ng-options="item.number as item.text for item in weekdayList">
                        <option value=""></option>
                    </select>
                </div>
                <div class="form-rel">
                    <label class="form-label">From</label>
                    <select chosen
                            width="130" id="startTime"
                            disable-search="false"
                            search-contains="true"
                            data-placeholder="Select time"
                            name="workSchedule" inherit-select-classes="true"
                            ng-model="schedule.startTime" class="time" required
                            ng-change="updateSchedule();setEndTimeList()"
                            ng-options="item for item in startTimeList">
                        <option value=""></option>
                    </select>
                    <span>to</span>
                    <select chosen
                            width="130" id="endTime"
                            disable-search="false"
                            search-contains="true"
                            data-placeholder="Select time"
                            name="workSchedule" inherit-select-classes="true"
                            ng-model="schedule.endTime" class="time" required
                            ng-change="updateSchedule()"
                            ng-options="item for item in endTimeList">
                        <option value=""></option>
                    </select>
                </div>
                <div class="form-rel">
                    <label class="form-label" for="location" ng-bind="schedule.repeat === 'Single' ? 'On' : 'Repeat from'"></label>
                    <div class="form-rel input-date date" ng-click="openDatepicker($event, 'from')">
                        <input datepicker-popup="dd/MM/yyyy" ng-click="openDatepicker($event, 'from')" is-open="showDatepicker.from"
                               datepicker-options="dateOptions" min-date="minStartDate"
                               ng-model="schedule.startDate" ng-change="updateSchedule();checkDate('startDate')"
                               class="date" type="text" placeholder="Select date" required clear-text="Clear"/>
                    </div>
                    <span ng-if="schedule.repeat !== 'Single'">to</span>
                    <div class="form-rel input-date date" ng-if="schedule.repeat !== 'Single'" ng-click="openDatepicker($event, 'to')">
                        <input datepicker-popup="dd/MM/yyyy" ng-click="openDatepicker($event, 'to')" is-open="showDatepicker.to"
                               datepicker-options="dateOptions" min-date="minEndDate" ng-disabled="!schedule.startDate"
                               ng-model="schedule.endDate" ng-change="updateSchedule();checkDate('endDate')"
                               class="date" type="text" placeholder="Select date" required clear-text="Clear"/>
                    </div>
                </div>
                <div class="form-rel" ng-if="form.$valid">
                    <p><span ng-if="schedule.repeat !== 'Single' && schedule.times">{{schedule.times + 1 + ' dates'}}</span><span ng-if="schedule.repeat === 'Single' || schedule.times === 0">1 Date</span> ( {{schedule.duration.hours}} {{schedule.duration.minutes}} <span ng-if="schedule.times">each </span>)</p>
                    <p ng-if="schedule.repeat !== 'Weekly'">Starting {{schedule.startDate | amDateFormat: 'MMMM D YYYY'}} <span ng-if="schedule.times">through {{schedule.endDate | amDateFormat: 'MMMM D YYYY'}}</span></p>
                    <p ng-if="schedule.repeat === 'Weekly'">Starting {{schedule.startDateWeekly | amDateFormat: 'MMMM D YYYY'}} <span ng-if="schedule.times">through {{schedule.endDateWeekly | amDateFormat: 'MMMM D YYYY'}}</span></p>
                </div>
                <div class="form-rel" ng-if="form.$invalid">
                    <p>No dates created by schedule</p>
                </div>
                <div class="form-rel">
                    <button class="green" ng-disabled="form.$invalid" type="submit">Save</button><button type="button" ng-click="fetchOccurrences()">Cancel</button>
                </div>
            </form>
        </div>
        <!--<pre style="position: absolute; right: 0; top: 0; ">{{class | json}}</pre>-->
        <div class="form-rel">
            <label class="form-label" for="level">Level</label>
            <select chosen
                    id="level"
                    ng-model="class.level"
                    data-placeholder="Alle Levels"
                    disable-search="true"
                    allow-single-deselect="true"
                    ng-options="item for item in levels">
                <option value=""></option>
            </select>
        </div>
        <div class="form-rel flex">
            <div class="form-row">
                <label class="form-label" for="capacity">Max. Teilnehmer</label>
                <input class="form-input" type="text" ng-model="class.capacity" id="capacity"/>
            </div>
            <div class="form-row">
                <label class="form-label" for="dropInPrice">Preis vom Drop-in</label>
                <div class="input-euro"><input class="form-input" type="text" ng-model="class.dropInPrice" id="dropInPrice"/></div>
            </div>
        </div>
        <div class="form-rel">
            <label class="form-label" for="teacher">Lehrer</label>
            <input class="form-input" type="text" ng-model="class.teacherName" id="teacher"/>
        </div>
        <div class="form-rel">
            <label class="form-label" for="studio">Studio</label>
            <select chosen
                    id="studio"
                    ng-model="class.studioId"
                    data-placeholder="Select Studio"
                    disable-search="false"
                    ng-options="item.id as item.name for item in studios">
                <option value=""></option>
            </select>
        </div>
        <div class="form-rel large" disable-animate>
            <label class="form-label">Disziplin</label>
            <tags-input ng-model="tags" on-tag-added="importTag('tags')" on-tag-removed="importTag('tags')"></tags-input>
        </div>
        <div class="form-rel large" disable-animate>
            <label class="form-label">Stil</label>
            <tags-input ng-model="sub" on-tag-added="importTag('sub')" on-tag-removed="importTag('sub')"></tags-input>
        </div>
        <div class="form-rel large">
            <label class="form-label" for="description">Beschreibung</label>
            <textarea ng-model="class.description" id="description"></textarea>
        </div>
        <div class="form-rel">
            <div class="form-check">
                <input type="checkbox" id="requiresRegistration" value="true" ng-model="class.requiresRegistration" name="requiresRegistration" />
                <i class="fa"></i>
                <label for="requiresRegistration">Anmeldung erforderlich</label>
            </div>
        </div>
        <div class="form-rel">
            <div class="form-check">
                <input type="checkbox" id="blackOnly" value="true" ng-model="class.blackOnly" name="blackOnly" />
                <i class="fa"></i>
                <label for="blackOnly">Nur Black Card</label>
            </div>
        </div>
        <!--<div ng-repeat="(key, value) in groupByTime">-->
            <!--<h1>{{key}}</h1>-->
            <!--<div ng-repeat="(key, duration) in value">-->
                <!--<h2>{{key}}</h2>-->
                <!--<div ng-repeat="(key, days) in duration">-->
                    <!--<h3>{{moment.day(key) | amDateFormat: 'dddd'}}</h3>-->
                    <!--<div ng-repeat="(key, repeats) in days">-->
                        <!--<h4>Group {{key}}</h4>-->
                        <!--<div ng-repeat="c in repeats">-->
                            <!--{{c.startTime}} - {{c.endTime}} : {{c.duration}} = {{c.weekly}} /// {{c.start_date | amDateFormat: 'dddd, MMMM Do YYYY, HH:mm:ss'}}-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->
        <!--<div ng-repeat="(key, value) in groupByAll">-->
            <!--<h1>{{key}} {{value.repeat}} {{value.day}} {{value.time}}</h1>-->
            <!--<h2>{{value.frame}}</h2>-->
            <!--<div ng-repeat="c in value">-->
                <!--<strong>{{c.id}}</strong> {{c.startTime}} - {{c.endTime}} : {{c.duration}} /// {{c.start_date | amDateFormat: 'dddd, MMMM Do YYYY'}} ___ {{c.daily}} / {{c.weekly}}-->
            <!--</div>-->
        <!--</div>-->
    </div>
</div>