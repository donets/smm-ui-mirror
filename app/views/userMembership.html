<div class="container">
    <div class="overview cf">
        <div class="w-left">
            <div class="widget-overview photo">
                <h3 class="form-title" translate>My photo</h3>
                <img ng-if="membership.photo" ng-src="{{membership.photo}}" alt=""/>
                <button class="form-button" ng-click="upload('avatar')" translate>Upload</button>
            </div>
        </div>
        <div class="w-right">
            <div class="form-overview">
                <h3 class="form-title" translate>Personal details</h3>
                <ul>
                    <li>
                        <b translate>Name:</b>
                        <p>{{membership.fullName}}</p>
                    </li>
                    <li>
                    <b translate>Email:</b>
                    <p>{{membership.email}}</p>
                </li>
                    <li>
                    <b translate>Subscription city:</b>
                    <p>{{membership.city.defaultName}}</p>
                </li>
                    <li>
                    <b translate>Shipping address (for the card)</b>
                    <p>{{membership.deliveryAddress.fullAddress}}</p>
                </li>
                </ul>
            </div>
            <div class="form-overview">
                <h3 class="form-title" translate>Subscription details</h3>
                <ul>
                    <li>
                        <b translate>Card number:</b>
                        <p>{{membership.cardNumber}}</p>
                    </li>
                    <li>
                        <b translate>Status:</b>
                        <div>
                        <p ng-if="membership.orderRefundPossible">Trial</p>
                        <p ng-if="membership.cancelled">Cancelled</p>
                        <p ng-hide="membership.orderRefundPossible || membership.cancelled">{{membership.current.status}}</p>
                        <a class="form-link" href="" ng-if="!membership.active && membership.earliestActivationPossible !== null" ng-click="activateMembership()">Activate subscription</a>
                        <a class="form-link" href="" ng-if="membership.active && membership.earliestPausePossible !== null" ng-click="suspendMembership()">Suspend subscription</a>
                        <a class="form-link" href="" ng-if="membership.active" ng-click="cancelMembership()">Cancel subscription</a>
                        </div>
                    </li>
                    <li>
                        <b translate>Card type:</b>
                        <p>{{currentCard.displayName}}</p>
                    </li>
                    <li ng-if="!voucher || (!voucher.freeSubscriptionGranted && voucher.discountDuarationInMonths)">
                        <b translate>Current monthly price:</b>
                        <p translate><span ng-if="currentCard.currencyCode === 'GBP'">&pound;</span>{{currentCard.monthlyPrice}}<span ng-if="currentCard.currencyCode === 'EUR'">&euro;</span> / Month</p>
                    </li>
                    <li ng-if="voucher.freeSubscriptionGranted">
                        <b translate>Special price:</b>
                        <p translate>0€ / Month</p>
                    </li>
                    <li ng-if="!voucher.freeSubscriptionGranted && voucher">
                    <b translate>Discounted price:</b>
                    <p class="green"><span ng-if="voucher.percentOff">{{(Math.floor(currentCard.monthlyPrice * (10 - voucher.percentOff / 10) * 10) / 100).toFixed(2)}}€</span><span ng-if="voucher.amountOff">{{currentCard.monthlyPrice - voucher.amountOff}}€</span> <span ng-if="voucher.discountDuarationInMonths" translate>/ Monat für {{voucher.discountDuarationInMonths}} Monate</span></p>
                    </li>
                    <li ng-if="membership.discount">
                    <b translate>Current discount:</b>
                    <p>{{membership.discount.voucherCode}} <span ng-if="membership.discountExpires">expires {{membership.discountExpires | date: 'dd.MM.yyyy'}}</span></p>
                    </li>
                    <li>
                        <b translate>Membership start date:</b>
                        <p>{{membership.subscriptionStartsOn | date: 'dd.MM.yyyy'}}</p>
                    </li>
                    <li ng-if="membership.pauseStartsOn">
                        <b translate>Pause scheduled from:</b>
                        <p>{{membership.pauseStartsOn | date: 'dd.MM.yyyy'}}</p>
                    </li>
                    <li>
                        <b translate>Pause duration:</b>
                        <p>{{membership.pauseDurationMonths}}</p>
                    </li>
                    </ul>
                <ul>
                    <li class="actions">
                        <b translate>Payment method:</b>
                        <p ng-if="membership.paymentProvider === 'STRIPE'" translate>Credit card</p>
                        <p ng-if="membership.paymentProvider === 'ELV'" translate>Direct debit</p>
                    </li>
                    <li>
                        <a class="form-link" ng-hide="changePayment" ng-click="changePayment = true" href="">Update payment data</a>
                    </li>
                </ul>
            </div>
            <form name="formCheckout" id="step3" ng-show="changePayment" class="form-signup form-checkout" ng-submit="changePaymentSubmit()">
                <div ng-if="!voucher.freeSubscriptionGranted && order.paymentProvider === 'STRIPE'">
                    <h3 class="form-title cf" translate>Payment information
                        <a class="stripe-link" target="_blank" href="https://stripe.com"><img src="images/stripe.svg" alt="stripe"/></a>
                    </h3>
                    <div ng-class="{'error': error === 'CardException'}" class="form-group">
                        <div class="form-rel">
                            <label class="form-label required" for="cardNumber" translate>Credit card</label>
                            <input type="text" ng-model="order.card.number" ng-change="orderChange('card');checkCard(order.card.number)" id="cardNumber" name="cardNumber" placeholder="{{'Card number'|translate}}" ng-pattern="/^\d{8,}$/" required />
                            <img class="credit-card" ng-show="creditCard === 'visa'" src="images/visa-icon.svg" alt=""/>
                            <img class="credit-card" ng-show="creditCard === 'masterCard'" src="images/mastercard-icon.svg" alt=""/>
                            <img class="credit-card" ng-show="creditCard === 'maestroCard'" src="images/maestro-icon.svg" alt=""/>
                            <div ng-show="formCheckout.cardNumber.$dirty && formCheckout.cardNumber.$invalid">
                                <div ng-show="formCheckout.cardNumber.$error.required" class="form-message form-error" translate>This is an obligatory field</div>
                                <div ng-show="formCheckout.cardNumber.$error.pattern" class="form-message form-error" translate>Please enter a valid credit card number</div>
                            </div>
                            <i ng-show="formCheckout.cardNumber.$valid" class="fa fa-check check-valid"></i>
                        </div>
                        <div class="form-rel flex">
                            <div class="third" ng-class="{'chosen-valid': formCheckout.cardMonth.$dirty && formCheckout.cardMonth.$valid}">
                                <label class="form-label required" translate>Valid until</label>
                                <select chosen required name="cardMonth" width="'100%'" id="exp_month" class="third"
                                        ng-model="order.card.exp_month" ng-change="orderChange('card')"
                                        data-placeholder="{{'Month'|translate}}"
                                        disable-search="true"
                                        ng-options="item for item in month">
                                    <option value="" ng-show="desktop"></option>
                                </select>
                            </div>
                            <div class="third" ng-class="{'chosen-valid': formCheckout.cardYear.$dirty && formCheckout.cardYear.$valid}">
                                <label class="form-label" ng-show="desktop"></label>
                                <select chosen required name="cardYear" width="'100%'" id="exp_year" class="third"
                                        ng-model="order.card.exp_year" ng-change="orderChange('card')"
                                        data-placeholder="{{'Year'|translate}}"
                                        disable-search="true"
                                        ng-options="item for item in year">
                                    <option value="" ng-show="desktop"></option>
                                </select>
                            </div>
                            <div class="third">
                                <label class="form-label required" for="cardCVC" translate>CVV</label>
                                <input type="text" ng-model="order.card.cvc" ng-pattern="/^\d{3,4}$/" ng-change="orderChange('card')" class="third" id="cardCVC" name="cardCVC" placeholder="{{'e.g. 123'|translate}}" required/>
                                <div ng-show="formCheckout.cardCVC.$dirty && formCheckout.cardCVC.$invalid">
                                    <div ng-show="formCheckout.cardCVC.$error.required" class="form-message form-error" translate>This is an obligatory field</div>
                                    <div ng-show="formCheckout.cardCVC.$error.pattern" class="form-message form-error" translate>Please enter the 3 or 4-digit security number (on the back of your card)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <a class="form-link" href="" ng-click="order.paymentProvider = 'ELV';order.card = {}" translate>No credit card?</a>
                    </div>
                </div>
                <div ng-if="!voucher.freeSubscriptionGranted && order.paymentProvider === 'ELV'">
                    <h3 class="form-title cf" translate>SEPA direct debit</h3>
                    <div class="form-group">
                        <div class="form-rel">
                            <label class="form-label required" for="nameAccount" translate>Bank account holder</label>
                            <input type="text" ng-model="order.card.name" id="nameAccount" name="name" placeholder="{{'Your Name'|translate}}" required />
                            <div ng-show="formCheckout.name.$dirty && formCheckout.name.$invalid">
                                <div ng-show="formCheckout.name.$error.required" class="form-message form-error" translate>This is an obligatory field</div>
                            </div>
                        </div>
                        <div class="form-rel">
                            <label class="form-label required" for="iban" translate>IBAN</label>
                            <input type="text" ng-model="order.card.iban" id="iban" name="iban" placeholder="{{'e.g. DE12 3456 7890 1234 5678 90'|translate}}" required />
                            <div ng-show="formCheckout.iban.$dirty && formCheckout.iban.$invalid">
                                <div ng-show="formCheckout.iban.$error.required" class="form-message form-error" translate>This is an obligatory field</div>
                            </div>
                        </div>
                        <div class="form-rel">
                            <label class="form-label required" for="bic" translate>SWIFT-BIC</label>
                            <input type="text" ng-model="order.card.bic" id="bic" name="bic" placeholder="{{'e.g. ABCD1234'|translate}}" required />
                            <div ng-show="formCheckout.bic.$dirty && formCheckout.bic.$invalid">
                                <div ng-show="formCheckout.bic.$error.required" class="form-message form-error" translate>This is an obligatory field</div>
                            </div>
                        </div>
                    </div>
                    <p class="text" translate>SEPA direct debit consent: I hereby authorise the recipient Somuchmore UG to debit my account for services provided. I also instruct my bank to honour direct debit requests from this recipient.</p>
                    <p class="text" translate>Please note: You can cancel your direct debit payment any time by sending an e-mail to our customer service team.</p>
                    <div class="form-group">
                        <a class="form-link" href="" ng-click="order.paymentProvider = 'STRIPE';order.card = {};checkCard()" translate>Payment by credit card?</a>
                    </div>
                </div>
                <div class="form-rel" ng-show="showSpinner">
                    <span class="spinner" us-spinner="{lines: 11, radius:10, width:5, length: 7, color: '#ff695c', left: 0, top: 20}"></span>
                </div>
                <button class="large" type="submit" ng-hide="showSpinner" ng-disabled="!formCheckout.$valid || errorVoucher" translate>Submit new payment data</button>
            </form>
        </div>
    </div>
</div>
