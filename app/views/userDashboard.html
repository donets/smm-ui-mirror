<div class="dashboard-title" sticky use-placeholder>
    <div class="container">
        <div class="b-filters cf">
            <div ng-if="desktop" class="main-filters">
                <em translate>Show</em>
                <select chosen
                        id="discipline"
                        ng-model="search.class.discipline"
                        data-placeholder="{{'All activities'|translate}}"
                        disable-search="false"
                        allow-single-deselect="true"
                        ng-options="item for item in disciplines | orderBy: 'toString()'">
                    <option value=""></option>
                </select>
                <em translate>in</em>
                <select chosen name="city"
                        ng-model="cityId" ng-change="changeCity(cityId)"
                        data-placeholder="{{'City'|translate}}"
                        ng-options-disabled="!item.active for item in cities"
                        ng-options="item.id as item.defaultName for item in cities">
                    <option value=""></option>
                </select>
                <select chosen
                        id="neigbourhood"
                        ng-model="search.class.location"
                        data-placeholder="{{'All districts'|translate}}"
                        disable-search="false"
                        allow-single-deselect="true"
                        ng-options="item.name as item.name for item in neigbourhood | orderBy: 'toString()'">
                    <option value=""></option>
                </select>
                <em translate>, or</em>
                <select chosen
                        id="studio"
                        ng-model="search.class.studioId"
                        data-placeholder="{{'All studios'|translate}}"
                        disable-search="false"
                        allow-single-deselect="true"
                        ng-options="item.id as item.name for item in studios | orderBy: 'name'">
                    <option value=""></option>
                </select>
            </div>
            <div ng-if="desktop" class="short-filters">
                <ul class="filters-list">
                    <li>{{search.class.discipline ? search.class.discipline : 'All activities'}}</li>
                    <li>{{_.findWhere(cities, {id: cityId}).defaultName}}</li>
                    <li>{{search.class.location ? search.class.location : 'All districts'}}</li>
                    <li>{{search.class.studioId ? _.findWhere(studios, {id: search.class.studioId}).name : 'All Studios'}}</li>
                </ul>
            </div>
            <div ng-if="desktop" class="short-time">
                {{currDay | amCalendar}}
            </div>
            <div ng-if="desktop" class="weekdays-wrapper">
                <button ng-disabled="today.isSame(weekdays[0])" class="nav-button left" ng-click="changeWeek('sub')"><i class="fa fa-angle-left"></i></button>
                <ul class="weekdays-dashboard">
                    <li ng-class="{'current' : currDay.isSame(w, 'd')}" ng-repeat="w in weekdays" ng-click="changeDay(cityId, w)">{{w | amCalendar}}</li>
                </ul>
                <button class="nav-button right" ng-click="changeWeek('add')"><i class="fa fa-angle-right"></i></button>
            </div>
            <div ng-if="desktop" class="slider">
                <b class="time start">{{search.start}}:00</b><div range-slider min="search.min" max="search.max" model-min="search.start" model-max="search.end" step="1" show-values="false" prevent-equal-min-max="true"></div><b class="time end">{{search.end}}:00</b>
            </div>
            <div ng-if="mobile" class="mobile-controls">
                <div class="form-rel">
                    <button class="control-button" ng-click="openDatepicker($event, 'mobile')">{{currDay | amCalendar}}<i class="fa fa-calendar"></i></button>
                    <input class="input-date" datepicker-popup="dd.MM.yyyy" is-open="showDatepicker.mobile"
                           datepicker-options="dateOptions" min-date="minStartDate" ng-change="changeDay(cityId, moment(currDay))"
                           class="form-input" ng-model="currDay" type="text" show-button-bar="false"/>
                </div>
                <div class="form-rel">
                    <button class="control-button" ng-click="filtersMobileShow()">
                        {{search.class.discipline || search.class.location || search.class.studioId ? (events
                            | isAfter: 'start_date': search.start
                            | isBefore: 'end_date': search.end
                            | dataFilter: 'class.discipline': search.class.discipline
                            | dataFilter: 'class.style': search.class.style
                            | dataFilter: 'class.location': search.class.location
                            | dataFilter: 'class.studioId': search.class.studioId
                            | dataFilter: 'class.levels': search.class.levels).length + (' found' | translate) : ('Search' | translate)}}<i ng-hide="filtersMobile" class="fa fa-angle-down"></i><i ng-show="filtersMobile" class="fa fa-angle-up"></i></button>
                </div>
            </div>
            <div class="mobile-filters" ng-show="filtersMobile" ng-if="mobile">
                <select chosen
                        id="discipline" width="'100%'"
                        ng-model="search.class.discipline"
                        data-placeholder="{{'All activities'|translate}}"
                        disable-search="false"
                        allow-single-deselect="true"
                        ng-options="item for item in disciplines | orderBy: 'toString()'">
                    <option value="" translate>All activities</option>
                </select>
                <select chosen name="city" width="'100%'"
                        ng-model="cityId" ng-change="changeCity(cityId)"
                        data-placeholder="{{'City'|translate}}"
                        ng-options-disabled="!item.active for item in cities"
                        ng-options="item.id as item.defaultName for item in cities">
                    <option value="" ng-show="desktop"></option>
                </select>
                <select chosen
                        id="neigbourhood" width="'100%'"
                        ng-model="search.class.location"
                        data-placeholder="{{'All districts'|translate}}"
                        disable-search="false"
                        allow-single-deselect="true"
                        ng-options="item.name as item.name for item in neigbourhood | orderBy: 'toString()'">
                    <option value="" translate>All districts</option>
                </select>
                <select chosen
                        id="studio" width="'100%'"
                        ng-model="search.class.studioId"
                        data-placeholder="{{'All studios'|translate}}"
                        disable-search="false"
                        allow-single-deselect="true"
                        ng-options="item.id as item.name for item in studios | orderBy: 'name'">
                    <option value="" translate>All studios</option>
                </select>
                <div class="slider">
                    <b class="time start">{{search.start}}:00</b><div range-slider min="search.min" max="search.max" model-min="search.start" model-max="search.end" step="1" show-values="false" prevent-equal-min-max="true"></div><b class="time end">{{search.end}}:00</b>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="dashboard">
    <div class="container cf">
        <div class="w-left" ng-if="mobile">
            <div class="b-class-item" ng-repeat="e in events
                            | isAfter: 'start_date': search.start
                            | isBefore: 'end_date': search.end
                            | dataFilter: 'class.discipline': search.class.discipline
                            | dataFilter: 'class.style': search.class.style
                            | dataFilter: 'class.location': search.class.location
                            | dataFilter: 'class.studioId': search.class.studioId
                            | dataFilter: 'class.levels': search.class.levels | orderBy: 'startTime'">
                <div class="b-class-item__time">
                    <b>{{e.start_date | amDateFormat: 'HH:mm'}}<span ng-if="desktop"> – {{e.end_date | amDateFormat: 'HH:mm'}}</span></b>
                </div>
                <div class="b-class-item__info">
                    <b>{{e.class.title}}</b>
                    <p>{{e.class.discipline}}, {{e.class.teacherName}}</p>
                    <p><i class="fa fa-map-marker"></i> {{e.class.location}}<span ng-if="e.class.studio.name">, {{e.class.studio.name}}</span></p>
                    <p class="description" ng-if="e.class.description">{{e.class.description}}</p>
                    <p class="success" ng-if="e.success"><i class="fa fa-check-circle"></i>{{'Reserved for you' | translate}}</p>
                </div>
                <button class="class-button" ng-hide="e.showSpinner || e.success" ng-click="submitBook(e)" type="button" translate>Reserve</button>
                <div class="form-response">
                    <div ng-show="e.showSpinner" class="form-spinner"><i class="fa fa-spinner fa-spin"></i></div>
                </div>
            </div>
            <div ng-if="!(events
                            | isAfter: 'start_date': search.start
                            | isBefore: 'end_date': search.end
                            | dataFilter: 'class.discipline': search.class.discipline
                            | dataFilter: 'class.style': search.class.style
                            | dataFilter: 'class.location': search.class.location
                            | dataFilter: 'class.studioId': search.class.studioId
                            | dataFilter: 'class.levels': search.class.levels).length">
                <p translate>There are no courses available for this day and this search. Try another date or reset the filters.</p>
            </div>
        </div>
        <div class="b-class-table" ng-if="desktop">
            <table ng-hide="showSpinner" class="timetable">
                <tbody>
                    <tr ng-repeat="e in events
                            | isAfter: 'start_date': search.start
                            | isBefore: 'end_date': search.end
                            | dataFilter: 'class.discipline': search.class.discipline
                            | dataFilter: 'class.style': search.class.style
                            | dataFilter: 'class.location': search.class.location
                            | dataFilter: 'class.studioId': search.class.studioId
                            | dataFilter: 'class.levels': search.class.levels | orderBy: 'startTime'" >
                        <td>
                            <p>{{e.startTime}} - {{e.endTime}}</p>
                        </td>
                        <td><span class="title">{{e.class.title}}</span></td>
                        <td>{{e.class.discipline}}</td>
                        <td><i class="fa fa-map-marker"></i> {{e.class.location}}<span ng-if="e.class.studio.name">, {{e.class.studio.name}}</span></td>
                        <td><button class="class-button" ng-click="bookClass(e)" type="button" translate>Reserve</button></td>
                    </tr>
                    <tr ng-if="!(events
                            | isAfter: 'start_date': search.start
                            | isBefore: 'end_date': search.end
                            | dataFilter: 'class.discipline': search.class.discipline
                            | dataFilter: 'class.style': search.class.style
                            | dataFilter: 'class.location': search.class.location
                            | dataFilter: 'class.studioId': search.class.studioId
                            | dataFilter: 'class.levels': search.class.levels).length">
                        <td class="empty" colspan="7" translate>There are no courses available for this day and this search. Try another date or reset the filters.</td>
                    </tr>
                </tbody>
            </table>
            <div ng-show="showSpinner" class="dashboard-spinner">
                <span class="spinner" us-spinner="{lines: 11, radius:10, width:5, length: 7, color: '#f7820f', left: 0, top: 0}"></span>
            </div>
        </div>
    </div>
    <!--<div class="container cf">
        <div class="w-right b-classes-list">
            <table class="timetable user-classes">
                <thead>
                    <tr>
                        <th translate>Time</th>
                        <th translate>Course</th>
                        <th translate>Disciplines</th>
                        <th translate>Styles</th>
                        <th translate>Teacher</th>
                        <th translate>Studio</th>
                        <th translate>District</th>
                        &lt;!&ndash;<th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="e in events
                            | limitTo: showPopap ? 15 : events.length
                            | isSame: 'start_date': currDay
                            | isAfter: 'start_date': search.start
                            | isBefore: 'end_date': search.end
                            | filter: {class: {title: search.class.title}}
                            | filter: {class: {teacherName: search.class.teacherName}}
                            | dataFilter: 'class.discipline': search.class.discipline
                            | dataFilter: 'class.style': search.class.style
                            | dataFilter: 'class.location': search.class.location
                            | dataFilter: 'class.studioId': search.class.studioId
                            | dataFilter: 'class.levels': search.class.levels" >
                        <td>
                            <p>{{e.start_date | amDateFormat: 'HH:mm'}}</p>
                            <p>{{e.end_date | amDateFormat: 'HH:mm'}}</p>
                        </td>
                        <td><a class="link-description" ng-click="attend(e)" href="" ng-if="e.class.description">{{e.class.title}}</a><span ng-if="!e.class.description">{{e.class.title}}</span></td>
                        <td>{{e.class.discipline}}</td>
                        <td>{{e.class.style}}</td>
                        <td>{{e.class.teacherName}}</td>
                        <td>
                            <a ui-sref="studio({studioId: e.class.studio.id})" ng-if="e.class.studio.profileComplete">{{e.class.studio.name}}</a>
                            <a ng-href="{{e.class.studio.website}}" ng-if="!e.class.studio.profileComplete && e.class.studio.website" target="_blank">{{e.class.studio.name}}</a>
                            <span ng-if="!e.class.studio.profileComplete && !e.class.studio.website">{{e.class.studio.name}}</span>
                        </td>
                        <td>{{e.class.location}}</td>
                        <td><button class="default" ng-click="attend(e)" type="button"></i>Teilnehmen</button></td>
                    </tr>
                    <tr ng-if="!(events
                        | isSame: 'start_date': currDay
                        | isAfter: 'start_date': search.start
                        | isBefore: 'end_date': search.end
                        | filter: {class: {title: search.class.title}}
                        | filter: {class: {teacherName: search.class.teacherName}}
                        | dataFilter: 'class.discipline': search.class.discipline
                        | dataFilter: 'class.style': search.class.style
                        | dataFilter: 'class.location': search.class.location
                        | dataFilter: 'class.studioId': search.class.studioId
                        | dataFilter: 'class.levels': search.class.levels).length">
                        <td class="empty" colspan="7" translate>There are no courses available for this day and this search. Try another date or reset the filters.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>-->
    <div ng-if="showPopap" class="modal-backdrop fade in" style="position: absolute; z-index: 1040;"></div>
    <div ng-if="showPopap" class="modal fade modal-message in" style="position: absolute; z-index: 1050; display: block;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body ng-scope">
                    <h2 translate>Thank you for your registration!</h2>
                    <p translate>From now on you can find a list of all our partner studios here. You can even start before your card arrives. Print out your class confirmation and take a photo ID to your chosen studio, et voilá! Have Fun!</p>
                    <button class="form-button" ng-class="{'en': lang === 'en'}" ng-click="hidePopap()" translate>Continue to the courses</button>
                </div>
            </div>
        </div>
    </div>
</div>